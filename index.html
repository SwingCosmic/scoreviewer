<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="main.js"></script>
    <style type="text/css">
		header{
			color:white;
			font-weight:bold;
			background:#06F;	
		}
    	#text_area{
			overflow:scroll;
			height:500px;
			width:500px;	
		}
		p{
			color:#009;
			font-weight:bold;
			position:relative;
			left:10px;
		}
    </style>
    <title>SIF谱面保管所(Beta)</title>
</head>

<body>
	<header>
		<h1 style="top:20px;left:20px;position:relative;">欢迎...</h1>
		<h2 style="top:20px;left:20px;position:relative;" id="func_dis">SIF谱面保管所(Beta)</h2>
		<p><br/></p>
	</header>
    
    <div style="background:#FFF;left:10px;position:relative">
    	<pre>1、使用本功能可以查询SIF日服已实装的所有谱面的直线图</pre>
        <pre>2、如果知道歌曲bpm，请手动填入，并选择节拍线间隔，这样能够方便地观看谱面</pre>
        <pre>3、有关曲目bpm的信息可以在 <span style="color:#009;cursor:pointer;text-decoration:underline;"
         	onclick="link1();">日服WIKI</span> 查询</pre>
        <pre>4、变速歌曲请不要选择画节拍线！暂时不支持！画了肯定对不准！</pre>
        <pre>5、本功能使用了ieb（微博：<span style="color:#009;cursor:pointer;text-decoration:underline;"
         	onclick="link2();">@电玩果</span>）提供的曲库信息API</pre>
        <pre>3、若想查看自己的自制谱(.json)实际效果， <span style="color:#009;cursor:pointer;text-decoration:underline;"
         	onclick="link3();">点击此处</span> 前往</pre>
	</div><hr/>
    
    <p>请选择谱面拉伸程度（数字越大表示显示的谱面越长）：
    	<select id="space">
        	<option value = "200">200</option>
            <option value = "250">250</option>
            <option value = "300">300</option>
            <option value = "350">350</option>
            <option value = "100">100</option>
        </select></p>
    <p>请输入歌曲bpm（可选）：<input type="text" id="bpm" style="width:6em"/>&nbsp;
       节拍线间距：<select id="grid_ival">
        	<option value = "0">（不画节拍线）</option>
        	<option value = "3">12分音</option>
            <option value = "4">16分音</option>
            <option value = "6">24分音</option>
            <option value = "8">32分音</option>
        </select></p>
    <p>歌曲属性：
    	<select id="song_attr">
        	<option value = "0">（全部）</option>
        	<option style="color:red" value = "1">SMILE</option>
            <option style="color:green" value = "2">PURE</option>
            <option style="color:blue" value = "3">COOL</option>
        </select>&nbsp;
       谱面等级：
        <select id="song_level">
        	<option value = "12">★12</option>
            <option value = "11">★11</option>
            <option value = "10">★10</option>
            <option value = "9">★9</option>
        	<option value = "8">★8</option>
            <option value = "7">★7</option>
            <option value = "6">★6</option>
            <option value = "5">★5</option>
            <option value = "4">★4</option>
            <option value = "3">★3</option>
            <option value = "2">★2</option>
            <option value = "1">★1</option>  
        </select>&nbsp;
       谱面难度：
        <select id="song_type">
        	<option value = "0">（全部）</option>
        	<option value = "EASY">EASY</option>
            <option value = "NORMAL">NORMAL</option>
            <option value = "HARD">HARD</option>
            <option value = "EXPERT">EXPERT</option>
            <option value = "MASTER">MASTER</option>
        </select>&nbsp;
        <input type="button" value="确定筛选" onclick="confirm_fliter();"/></p>
    <p>或者直接搜索：<input id="song_name" style="width:15em"/>&nbsp;<input type="button" value="确定" onclick="confirm_search();"/></p>
    <hr/>
    <div id="songs" style="width:350px"></div>
    <script type="application/javascript">	
		function confirm_fliter(){$.getJSON("http://r.llsif.win/maps.json",function(data){get_beatmaps(data);});}
		function confirm_search(){$.getJSON("http://r.llsif.win/maps.json",function(data){search_beatmaps(data);});}
		
		function get_beatmaps(data)
		{
			var innerhtml = "";
			var songslist = document.getElementById("songs");
			var len = data.length;
			var song_attr = document.getElementById("song_attr").value;
			var song_level = document.getElementById("song_level").value;
			var song_type = document.getElementById("song_type").value;
			
			for(i=0;i<len;i++)
			{
				if(data[i]["stage_level"]==song_level)
				{
					if ((data[i]["difficulty_text"]!="TECHNICAL")&((data[i]["difficulty_text"]==song_type)|(song_type=="0")))
					{
						if ((data[i]["attribute_icon_id"]==song_attr)|(song_attr=="0"))
						{
							var beatmap_path = "http://a.llsif.win/live/json/"+data[i]["notes_setting_asset"];
							switch(data[i]["attribute_icon_id"])
							{
								case 1:{innerhtml = innerhtml + "<p onclick=readbeatmap('" + 
								beatmap_path + "','" + data[i]["live_track_id"] + "') style=\"color:red;cursor:pointer\">";break;}
								case 2:{innerhtml = innerhtml + "<p onclick=readbeatmap('" + 
								beatmap_path + "','" + data[i]["live_track_id"] + "') style=\"color:green;cursor:pointer\">";break;}
								case 3:{innerhtml = innerhtml + "<p onclick=readbeatmap('" + 
								beatmap_path + "','" + data[i]["live_track_id"] + "') style=\"color:blue;cursor:pointer\">";break;}
								default:break;
							}
							if(data[i]["live_setting_id"]>20000)innerhtml = innerhtml + "ARCADE - " + data[i]["name"]+"</p>";
							else innerhtml = innerhtml + data[i]["difficulty_text"] + " - " + data[i]["name"]+"</p>";
						}
					}
				}	
			}
			if(innerhtml=="")innerhtml="<p>（没有找到对应歌曲）</p>"
			songslist.innerHTML = innerhtml;
		}
		
		function search_beatmaps(data)
		{
			var innerhtml = "";
			var songslist = document.getElementById("songs");
			var len = data.length;
			var songname = document.getElementById("song_name").value;
			
			for(i=0;i<len;i++)
			{
				if((data[i]["name"].toLowerCase().indexOf(songname.toLowerCase())>=0)&(data[i]["difficulty_text"]!="TECHNICAL"))
				{
					var beatmap_path = "http://a.llsif.win/live/json/"+data[i]["notes_setting_asset"];
					switch(data[i]["attribute_icon_id"])
					{
						case 1:{innerhtml = innerhtml + "<p onclick=readbeatmap('" + 
						beatmap_path + "','" + data[i]["live_track_id"] + "') style=\"color:red;cursor:pointer\">";break;}
						case 2:{innerhtml = innerhtml + "<p onclick=readbeatmap('" + 
						beatmap_path + "','" + data[i]["live_track_id"] + "') style=\"color:green;cursor:pointer\">";break;}
						case 3:{innerhtml = innerhtml + "<p onclick=readbeatmap('" + 
						beatmap_path + "','" + data[i]["live_track_id"] + "') style=\"color:blue;cursor:pointer\">";break;}
						default:break;
					}
					if(data[i]["live_setting_id"]>20000)innerhtml = innerhtml + "ARCADE - " + data[i]["name"]+"</p>";
					else innerhtml = innerhtml + data[i]["difficulty_text"] + " - " + data[i]["name"]+"</p>";
				}	
			}
			if(innerhtml=="")innerhtml="<p>（没有找到对应歌曲）</p>"
			songslist.innerHTML = innerhtml;
		}
    </script>
</body>
</html>






